.. _magic_functions:

================
魔法函数与特殊变量
================

.. contents:: :local:


.. _introduction:

简介
------------

在 Python 中，魔法方法（Magic Methods）和特殊变量（Special Variables）都是通过特定的命名规则来定义的。魔法方法是一种在类中定义的特殊方法，它们以双下划线开头和结尾。Python 对象可以说天生就具有这些魔法方法，我们也可以通过对类添加或者重载这些特殊方法来实现自己想要的行为。所谓的魔法方法就是通过在类中定义该方法从而为对象赋予特殊的效果。

特殊变量是一些具有特殊含义的变量，它们也以双下划线开头和结尾。

由于 Python 内置魔法方法众多，在此我列举几个常见的魔法方法和特殊变量进行学习。


.. _magic_funcs:

常见魔法函数与使用
----------------------

对象初始化和销毁
^^^^^^^^^^^^^^^^
*__init__(self, ...)*: 初始化对象，在创建对象时调用。
*__del__(self)*: 销毁对象，在对象被删除时调用。

字符串表示和格式化
^^^^^^^^^^^^^^^^
*__str__(self)*: 返回对象的友好字符串表示形式，通过 str() 函数调用。
*__repr__(self)*: 返回对象的官方字符串表示形式，通过 repr() 函数调用。

比较操作
^^^^^^^^^^^^^^^^
*__eq__(self, other)*: 定义相等比较，通过 == 运算符调用。
*__ne__(self, other)*: 定义不相等比较，通过 != 运算符调用。
*__lt__(self, other)*: 定义小于比较，通过 < 运算符调用。
*__le__(self, other)*: 定义小于等于比较，通过 <= 运算符调用。
*__gt__(self, other)*: 定义大于比较，通过 > 运算符调用。
*__ge__(self, other)*: 定义大于等于比较，通过 >= 运算符调用。

算术运算
^^^^^^^^^^^^^^^^
*__add__(self, other)*: 定义加法操作，通过 + 运算符调用。
*__sub__(self, other)*: 定义减法操作，通过 - 运算符调用。
*__mul__(self, other)*: 定义乘法操作，通过 * 运算符调用。
*__truediv__(self, other)*: 定义真除法操作，通过 / 运算符调用。

容器操作
^^^^^^^^^^^^^^^^
*__len__(self)*: 返回对象的长度，通过 len() 函数调用。
*__getitem__(self, key)*: 定义索引操作，通过 obj[key] 调用。
*__setitem__(self, key, value)*: 定义赋值操作，通过 obj[key] = value 调用。
*__delitem__(self, key)*: 定义删除操作，通过 del obj[key] 调用。

上下文管理
^^^^^^^^^^^^^^^^
*__enter__(self)*: 进入上下文时执行的操作，与 with 语句配合使用。
*__exit__(self, exc_type, exc_value, traceback)*: 退出上下文时执行的操作，与 with 语句配合使用。


.. _magic_vars:

常见特殊变量与使用
----------------------

对象和类信息
^^^^^^^^^^^^^^^^
*__class__*: 对象所属的类。
*__name__*: 模块的名字，在主程序中为 "__main__"。
文档和注释
^^^^^^^^^^^^^^^^
*__doc__*: 对象的文档字符串。
*__annotations__*: 类型注解字典。
调试和诊断
^^^^^^^^^^^^^^^^
*__module__*: 定义对象的模块名。
*__dict__*: 包含对象命名空间的字典。
实例化和可调用
^^^^^^^^^^^^^^^^
*__call__(self, ...)*: 实例被调用时执行的操作，使对象可调用。
布尔值和长度
^^^^^^^^^^^^^^^^
*__bool__(self)*: 定义对象的布尔值，通过 bool(obj) 调用。
*__len__(self)*: 定义对象的长度，通过 len(obj) 调用。


参考
----------

以下是一些参考文章，可以深入学习 Python 魔法函数的更多内容：

- `Python 官方文档 - Data Model <https://docs.python.org/3/reference/datamodel.html>`_

- `Python Magic Methods by Example <https://rszalski.github.io/magicmethods/>`_
